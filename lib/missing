#! /bin/sh
# Common wrapper for a few potentially missing GNU programs.

scriptversion=2012-06-14.10; # UTC

# Copyright (C) 1996-2012 Free Software Foundation, Inc.
# Originally written by Fran,cois Pinard <pinard@iro.umontreal.ca>, 1996.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

# As a special exception to the GNU General Public License, if you
# distribute this file as part of a program that contains a
# configuration script generated by Autoconf, you may include it under
# the same distribution terms that you use for the rest of that program.

if test $# -eq 0; then
  echo 1>&2 "Try '$0 --help' for more information"
  exit 1
fi

# In the cases where this matters, 'missing' is being run in the
# srcdir already.
if test -f configure.ac; then
  configure_ac=configure.ac
else
  configure_ac=configure.in
fi

case $1 in

  --is-lightweight)
    # Used by our autoconf macros to check whether the available missing
    # script is modern enough.
    exit 0
    ;;

  -h|--h|--he|--hel|--help)
    echo "\
$0 [OPTION]... PROGRAM [ARGUMENT]...

Run 'PROGRAM [ARGUMENT]...', returning a proper advice when this fails due
to PROGRAM being missing or too old.

Options:
  -h, --help      display this help and exit
  -v, --version   output version information and exit

Supported PROGRAM values:
  aclocal   autoconf  autoheader   autom4te  automake  makeinfo
  bison     yacc      flex         lex       help2man

Version suffixes to PROGRAM as well as the prefixes 'gnu-', 'gnu', and
'g' are ignored when checking the name.

Send bug reports to <bug-automake@gnu.org>."
    exit $?
    ;;

  -v|--v|--ve|--ver|--vers|--versi|--versio|--version)
    echo "missing $scriptversion (GNU Automake)"
    exit $?
    ;;

  -*)
    echo 1>&2 "$0: unknown '$1' option"
    echo 1>&2 "Try '$0 --help' for more information"
    exit 1
    ;;

esac

# Run the given program, remember its exit status.
"$@"; st=$?

# If it succeeded, we are done.
test $st -eq 0 && exit 0

# Also exit now if we it failed (or wasn't found), and '--version' was
# passed; such an option is passed most likely to detect whether the
# program is present and works.
case $2 in --version|--help) exit $st;; esac

# Exit code 63 means version mismatch.  This often happens when the user
# tries to use an ancient version of a tool on a file that requires a
# minimum version.
if test $st -eq 63; then
  msg="probably too old"
elif test $st -eq 127; then
  # Program was missing.
  msg="missing on your system"
else
  # Program was found and executed, but failed.  Give up.
  exit $st
fi

# Normalize program name to check for.
program=`echo "$1" | sed '
  s/^gnu-//; t
  s/^gnu//; t
  s/^g//; t'`

# If it does not exist, or fails to run (possibly an outdated version),
# advise the user how to get it.
case $program in

  aclocal*)
    echo 1>&2 "\
WARNING: '$1' is $msg.  You should only need it if
         you modified 'acinclude.m4' or '${configure_ac}'.  You might want
         to install the Automake and Perl packages.  Grab them from
         any GNU archive site."
    ;;

  autoconf*)
    echo 1>&2 "\
WARNING: '$1' is $msg.  You should only need it if
         you modified '${configure_ac}'.  You might want to install the
         Autoconf and GNU m4 packages.  Grab them from any GNU
         archive site."
    ;;

  autoheader*)
    echo 1>&2 "\
WARNING: '$1' is $msg.  You should only need it if
         you modified 'acconfig.h' or '${configure_ac}'.  You might want
         to install the Autoconf and GNU m4 packages.  Grab them
         from any GNU archive site."
    ;;

  automake*)
    echo 1>&2 "\
WARNING: '$1' is $msg.  You should only need it if
         you modified 'Makefile.am', 'acinclude.m4' or '${configure_ac}'.
         You might want to install the Automake and Perl packages.
         Grab them from any GNU archive site."
    ;;

  autom4te*)
    echo 1>&2 "\
WARNING: '$1' is needed, but is $msg.
         You might have modified some files without having the
         proper tools for further handling them.
         You can get '$1' as part of Autoconf from any GNU
         archive site."
    ;;

  bison*|yacc*)
    echo 1>&2 "\
WARNING: '$1' $msg.  You should only need it if
         you modified a '.y' file.  You may need the Bison package
         in order for those modifications to take effect.  You can get
         Bison from any GNU archive site."
    ;;

  lex*|flex*)
    echo 1>&2 "\
WARNING: '$1' is $msg.  You should only need it if
         you modified a '.l' file.  You may need the Flex package
         in order for those modifications to take effect.  You can get
         Flex from any GNU archive site."
    ;;

  help2man*)
    echo 1>&2 "\
WARNING: '$1' is $msg.  You should only need it if
	 you modified a dependency of a manual page.  You may need the
	 Help2man package in order for those modifications to take
	 effect.  You can get Help2man from any GNU archive site."
    ;;

  makeinfo*)
    echo 1>&2 "\
WARNING: '$1' is $msg.  You should only need it if
         you modified a '.texi' or '.texinfo' file, or any other file
         indirectly affecting the aspect of the manual.  The spurious
         call might also be the consequence of using a buggy 'make' (AIX,
         DU, IRIX).  You might want to install the Texinfo package or
         the GNU make package.  Grab either from any GNU archive site."
    ;;

  *)
    echo 1>&2 "\
WARNING: '$1' is needed, and is $msg.
         You might have modified some files without having the
         proper tools for further handling them.  Check the 'README' file,
         it often tells you about the needed prerequisites for installing
         this package.  You may also peek at any GNU archive site, in case
         some other package would contain this missing '$1' program."
    ;;

esac

# Propagate the correct exit status (expected to be 127 for a program
# not found, 63 for a program that failed due to version mismatch).
exit $st

# Local variables:
# eval: (add-hook 'write-file-hooks 'time-stamp)
# time-stamp-start: "scriptversion="
# time-stamp-format: "%:y-%02m-%02d.%02H"
# time-stamp-time-zone: "UTC"
# time-stamp-end: "; # UTC"
# End:
